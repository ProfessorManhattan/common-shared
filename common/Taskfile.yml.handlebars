---
version: '3'

output: interleaved

vars:
{{#if (eq subgroup 'role')}}
  GALAXY_NAMESPACE:
    sh: if [ -f meta/main.yml ]; then yq e '.galaxy_info.namespace' meta/main.yml; else jq -r '.name' package.json | sed 's/\/.*//' | sed 's/@//'; fi
  GALAXY_ROLE_NAME:
    sh: if [ -f meta/main.yml ]; then yq e '.galaxy_info.role_name' meta/main.yml; else jq -r '.name' package.json | sed 's/.*\///'; fi
{{/if}}
  GITHUB_ORG: ProfessorManhattan
  GITHUB_USER: ProfessorManhattan
  NPM_PROGRAM: npm
  NPX_PACKAGE: npx
  REPOSITORY_SUBTYPE: '{{subgroup}}'
  REPOSITORY_TYPE: '{{group}}'
  TIMEZONE: America/New_York

includes:
{{#each (glob './.config/taskfiles/**/*.yml')}}
  {{remove (remove (remove (replace (remove this "./.config/taskfiles/") "/Taskfile-" ":") "/Taskfile.yml") "Taskfile-") ".yml"}}: {{this}}
{{/each}}

tasks:
  donothing: 'true'

  start:
    desc: Set up the project and refresh it with the latest changes
    summary: |
      # Set up the project

      This task will scaffold the project with the latest upstream changes
      and ensure your development environment has all the dependencies installed.

      **Example usage:**
      `task start`
    cmds:
      - task: '{{#eq group "common"}}upstream:common{{else}}common:update:update{{/eq}}
